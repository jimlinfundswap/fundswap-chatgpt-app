{
  "openapi": "3.1.0",
  "info": {
    "title": "FundSwap 基金查詢 API",
    "description": "查詢台灣基金資料、績效比較與排行。資料來源：FundSwap (fundswap.com.tw)",
    "version": "1.0.0"
  },
  "servers": [
    {
      "url": "https://fundswap-chatgpt-app-1.vercel.app"
    }
  ],
  "paths": {
    "/api/search-funds": {
      "get": {
        "operationId": "searchFunds",
        "summary": "搜尋基金",
        "description": "依關鍵字、基金類型、基金分類、風險等級、投資區域、配息頻率篩選基金。",
        "parameters": [
          {
            "name": "keyword",
            "in": "query",
            "description": "搜尋關鍵字（基金名稱、代碼、投信公司）",
            "schema": { "type": "string" }
          },
          {
            "name": "investmentTarget",
            "in": "query",
            "description": "基金類型",
            "schema": {
              "type": "string",
              "enum": ["股票型", "債券型", "平衡型", "貨幣型"]
            }
          },
          {
            "name": "riskLevel",
            "in": "query",
            "description": "風險等級（1 最低，5 最高）",
            "schema": { "type": "integer", "minimum": 1, "maximum": 5 }
          },
          {
            "name": "investmentArea",
            "in": "query",
            "description": "投資區域（如：台灣、全球、美國、歐洲）",
            "schema": { "type": "string" }
          },
          {
            "name": "fundNameCategory",
            "in": "query",
            "description": "基金分類",
            "schema": {
              "type": "string",
              "enum": [
                "ESG概念", "ETF及指數", "大型股票", "不分產業(股)", "不分產業(債)",
                "中小型股票", "中短期債券", "公用事業", "天然資源", "水資源",
                "可轉換債券", "生技醫療", "企業債券", "多元收益(債)", "投資等級債",
                "抗通膨債", "房地產", "股債混合", "金融服務", "非投資等級債",
                "政府債券", "科技", "消費服務", "能源", "貨幣市場",
                "貨幣對沖", "貴金屬", "新能源", "新興市場(股)", "新興市場(債)",
                "環境生態"
              ]
            }
          },
          {
            "name": "dividendFrequency",
            "in": "query",
            "description": "配息頻率",
            "schema": {
              "type": "string",
              "enum": ["不配息", "月配息", "季配息", "半年配息", "年配息", "未固定配息"]
            }
          },
          {
            "name": "tradingType",
            "in": "query",
            "description": "交易方式（PUR=單筆申購、SIP=定期定額、SWI=轉入、SWO=轉出、RDM=贖回）",
            "schema": {
              "type": "string",
              "enum": ["PUR", "SIP", "SWI", "SWO", "RDM"]
            }
          },
          {
            "name": "maxRiskLevel",
            "in": "query",
            "description": "最高風險等級（回傳 ≤ 此等級的基金，例如 3 表示只要 RR1~RR3）",
            "schema": { "type": "integer", "minimum": 1, "maximum": 5 }
          }
        ],
        "responses": {
          "200": {
            "description": "搜尋結果",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "total": { "type": "integer", "description": "符合條件的基金總數" },
                    "showing": { "type": "integer", "description": "本次回傳筆數（最多 20）" },
                    "funds": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/FundSummary" }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/fund-detail": {
      "get": {
        "operationId": "getFundDetail",
        "summary": "查詢基金詳情",
        "description": "查詢單一基金的完整資料，包含基本資料、績效表現、風險指標、前十大持股。",
        "parameters": [
          {
            "name": "mfxId",
            "in": "query",
            "required": true,
            "description": "基金代碼（如 ARGG、ED32）",
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "基金詳細資料",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/FundDetail" }
              }
            }
          },
          "404": {
            "description": "找不到該基金"
          }
        }
      }
    },
    "/api/compare-funds": {
      "post": {
        "operationId": "compareFunds",
        "summary": "比較基金",
        "description": "比較 2-5 檔基金的績效、風險指標與配息資訊。",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["mfx_ids"],
                "properties": {
                  "mfx_ids": {
                    "type": "array",
                    "items": { "type": "string" },
                    "minItems": 2,
                    "maxItems": 5,
                    "description": "要比較的基金代碼（2-5 檔）"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "基金比較結果",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "notFound": {
                      "type": "array",
                      "items": { "type": "string" },
                      "description": "找不到的基金代碼"
                    },
                    "funds": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/FundComparison" }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/search-by-holding": {
      "get": {
        "operationId": "searchByHolding",
        "summary": "依持股搜尋基金",
        "description": "搜尋持有特定公司股票的基金。支援多關鍵字（逗號分隔），例如搜尋 NVIDIA,台積電 會找出持有這些公司的基金，依持股比例排序。",
        "parameters": [
          {
            "name": "stockName",
            "in": "query",
            "required": true,
            "description": "股票/公司名稱關鍵字，多個用逗號分隔（如：NVIDIA,台積電,TSMC）",
            "schema": { "type": "string" }
          },
          {
            "name": "investmentTarget",
            "in": "query",
            "description": "限定基金類型",
            "schema": {
              "type": "string",
              "enum": ["股票型", "債券型", "平衡型", "貨幣型"]
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "顯示筆數（預設 10，最多 20）",
            "schema": { "type": "integer", "minimum": 1, "maximum": 20, "default": 10 }
          }
        ],
        "responses": {
          "200": {
            "description": "持有該股票的基金列表",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "query": { "type": "string" },
                    "total": { "type": "integer" },
                    "funds": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/HoldingMatch" }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/holdings-overlap": {
      "post": {
        "operationId": "holdingsOverlap",
        "summary": "持股重疊分析",
        "description": "分析 2-5 檔基金的持股重疊情況，找出共同持股、計算重疊比例，並提供集中度警示。適合檢查投資組合的分散度。",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["mfx_ids"],
                "properties": {
                  "mfx_ids": {
                    "type": "array",
                    "items": { "type": "string" },
                    "minItems": 2,
                    "maxItems": 5,
                    "description": "要分析的基金代碼（2-5 檔）"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "持股重疊分析結果",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/HoldingsOverlap" }
              }
            }
          }
        }
      }
    },
    "/api/complement-suggestions": {
      "get": {
        "operationId": "complementSuggestions",
        "summary": "組合搭配建議",
        "description": "根據已選基金的特性（類型、區域、風險等級），建議互補的搭配基金，幫助建立分散的投資組合。",
        "parameters": [
          {
            "name": "mfxId",
            "in": "query",
            "required": true,
            "description": "已選定的基金代碼",
            "schema": { "type": "string" }
          }
        ],
        "responses": {
          "200": {
            "description": "組合搭配建議",
            "content": {
              "application/json": {
                "schema": { "$ref": "#/components/schemas/ComplementSuggestions" }
              }
            }
          },
          "404": {
            "description": "找不到該基金"
          }
        }
      }
    },
    "/api/top-performers": {
      "get": {
        "operationId": "getTopPerformers",
        "summary": "基金排行榜（支援多種排序）",
        "description": "查詢基金排行榜，可依報酬率、夏普指數、配息率、標準差排序，並可篩選類型、分類、區域、風險等級、配息頻率。",
        "parameters": [
          {
            "name": "investmentTarget",
            "in": "query",
            "description": "基金類型（不填則顯示全部）",
            "schema": {
              "type": "string",
              "enum": ["股票型", "債券型", "平衡型", "貨幣型"]
            }
          },
          {
            "name": "fundNameCategory",
            "in": "query",
            "description": "基金分類（如：科技、貴金屬、ESG概念）",
            "schema": { "type": "string" }
          },
          {
            "name": "investmentArea",
            "in": "query",
            "description": "投資區域（如：全球、美國、日本、台灣、新興市場）",
            "schema": { "type": "string" }
          },
          {
            "name": "dividendFrequency",
            "in": "query",
            "description": "配息頻率（如：月配息、季配息、年配息、不配息）",
            "schema": { "type": "string" }
          },
          {
            "name": "maxRiskLevel",
            "in": "query",
            "description": "最高風險等級（回傳 ≤ 此等級的基金）",
            "schema": { "type": "integer", "minimum": 1, "maximum": 5 }
          },
          {
            "name": "sortBy",
            "in": "query",
            "description": "排序依據：3m/6m/1y/2y/3y/5y=依報酬率排序、sharpe=依夏普指數（高→低）、dividendYield=依配息率（高→低）、stddev=依年化標準差（低→高，波動最小優先）",
            "schema": {
              "type": "string",
              "enum": ["3m", "6m", "1y", "2y", "3y", "5y", "sharpe", "dividendYield", "stddev"],
              "default": "1y"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "顯示筆數（預設 10，最多 20）",
            "schema": { "type": "integer", "minimum": 1, "maximum": 20, "default": 10 }
          }
        ],
        "responses": {
          "200": {
            "description": "排行結果",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "sortBy": { "type": "string" },
                    "total": { "type": "integer" },
                    "funds": {
                      "type": "array",
                      "items": { "$ref": "#/components/schemas/FundRanking" }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "FundSummary": {
        "type": "object",
        "properties": {
          "mfxId": { "type": "string" },
          "fundShortName": { "type": "string" },
          "investmentTarget": { "type": "string" },
          "fundNameCategory": { "type": "string" },
          "riskLevel": { "type": "integer" },
          "generalIssuer": { "type": "string" },
          "investmentArea": { "type": "string" },
          "dividendFrequency": { "type": "string" },
          "rateOfReturn1Year": { "type": "number" },
          "rateOfReturn3Years": { "type": "number" },
          "tradingType": { "type": "array", "items": { "type": "string" }, "description": "交易方式（PUR=單筆申購、SIP=定期定額）" },
          "url": { "type": "string" }
        }
      },
      "FundDetail": {
        "type": "object",
        "properties": {
          "mfxId": { "type": "string" },
          "fundShortName": { "type": "string" },
          "investmentTarget": { "type": "string" },
          "fundNameCategory": { "type": "string" },
          "riskLevel": { "type": "integer" },
          "generalIssuer": { "type": "string" },
          "investmentArea": { "type": "string" },
          "dividendFrequency": { "type": "string" },
          "costPerformanceValue": { "type": "number" },
          "dividendAnnualizedYield": { "type": "number", "nullable": true },
          "dividendAnnualRateOfReturn": { "type": "number", "nullable": true },
          "returns": {
            "type": "object",
            "properties": {
              "3m": { "type": "number" },
              "6m": { "type": "number" },
              "1y": { "type": "number" },
              "2y": { "type": "number" },
              "3y": { "type": "number" },
              "5y": { "type": "number" }
            }
          },
          "annualizedStandardDeviation": { "type": "number" },
          "stockTop": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "stockName": { "type": "string" },
                "holdingRatio": { "type": "number" }
              }
            }
          },
          "categoryContext": {
            "type": "object",
            "description": "同類基金統計比較",
            "properties": {
              "category": { "type": "string", "description": "基金分類名稱" },
              "totalInCategory": { "type": "integer", "description": "同類基金總數" },
              "rankings": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "period": { "type": "string" },
                    "rank": { "type": "integer", "description": "排名（1 為最佳）" },
                    "percentile": { "type": "integer", "description": "前百分之幾" },
                    "categoryAvg": { "type": "number", "description": "同類平均報酬率" },
                    "fundReturn": { "type": "number", "description": "本基金報酬率" }
                  }
                }
              },
              "riskComparison": {
                "type": "object",
                "properties": {
                  "categoryAvgStdDev": { "type": "number", "description": "同類平均年化標準差" },
                  "fundStdDev": { "type": "number", "description": "本基金年化標準差" },
                  "interpretation": { "type": "string", "description": "風險解讀（如：低於同類平均）" }
                }
              }
            }
          },
          "url": { "type": "string" }
        }
      },
      "FundComparison": {
        "type": "object",
        "properties": {
          "mfxId": { "type": "string" },
          "fundShortName": { "type": "string" },
          "investmentTarget": { "type": "string" },
          "fundNameCategory": { "type": "string" },
          "riskLevel": { "type": "integer" },
          "generalIssuer": { "type": "string" },
          "investmentArea": { "type": "string" },
          "dividendFrequency": { "type": "string" },
          "costPerformanceValue": { "type": "number" },
          "returns": {
            "type": "object",
            "properties": {
              "3m": { "type": "number" },
              "6m": { "type": "number" },
              "1y": { "type": "number" },
              "2y": { "type": "number" },
              "3y": { "type": "number" },
              "5y": { "type": "number" }
            }
          },
          "annualizedStandardDeviation": { "type": "number" },
          "url": { "type": "string" }
        }
      },
      "HoldingMatch": {
        "type": "object",
        "properties": {
          "mfxId": { "type": "string" },
          "fundShortName": { "type": "string" },
          "investmentTarget": { "type": "string" },
          "fundNameCategory": { "type": "string" },
          "riskLevel": { "type": "integer" },
          "generalIssuer": { "type": "string" },
          "investmentArea": { "type": "string" },
          "dividendFrequency": { "type": "string" },
          "rateOfReturn1Year": { "type": "number" },
          "matchedHoldings": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "stockName": { "type": "string" },
                "holdingRatio": { "type": "number" }
              }
            }
          },
          "totalMatchedRatio": { "type": "number" },
          "url": { "type": "string" }
        }
      },
      "FundRanking": {
        "type": "object",
        "properties": {
          "rank": { "type": "integer" },
          "mfxId": { "type": "string" },
          "fundShortName": { "type": "string" },
          "investmentTarget": { "type": "string" },
          "investmentArea": { "type": "string" },
          "fundNameCategory": { "type": "string" },
          "riskLevel": { "type": "integer" },
          "generalIssuer": { "type": "string" },
          "dividendFrequency": { "type": "string" },
          "costPerformanceValue": { "type": "number", "description": "夏普指數（越高越好，衡量風險調整後報酬）" },
          "annualizedStandardDeviation": { "type": "number", "description": "年化標準差（波動度，越低越穩定）" },
          "dividendAnnualizedYield": { "type": "number", "nullable": true, "description": "年化配息率（%）" },
          "returns": {
            "type": "object",
            "properties": {
              "3m": { "type": "number" },
              "6m": { "type": "number" },
              "1y": { "type": "number" },
              "2y": { "type": "number" },
              "3y": { "type": "number" },
              "5y": { "type": "number" }
            }
          },
          "url": { "type": "string" }
        }
      },
      "HoldingsOverlap": {
        "type": "object",
        "properties": {
          "funds": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "mfxId": { "type": "string" },
                "fundShortName": { "type": "string" },
                "holdingCount": { "type": "integer", "description": "持股數量" },
                "url": { "type": "string" }
              }
            }
          },
          "overlapRatio": { "type": "number", "description": "持股重疊比例（百分比）" },
          "concentrationWarning": { "type": "string", "nullable": true, "description": "集中度警示（>50% 高度重疊、>30% 中度重疊，否則 null）" },
          "sharedHoldings": {
            "type": "array",
            "description": "被 2 檔以上基金同時持有的股票",
            "items": {
              "type": "object",
              "properties": {
                "stockName": { "type": "string" },
                "heldByCount": { "type": "integer", "description": "被幾檔基金持有" },
                "avgHoldingRatio": { "type": "number", "description": "平均持股比例" },
                "details": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "properties": {
                      "mfxId": { "type": "string" },
                      "holdingRatio": { "type": "number" }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "ComplementSuggestions": {
        "type": "object",
        "properties": {
          "baseFund": {
            "type": "object",
            "description": "已選的基金",
            "properties": {
              "mfxId": { "type": "string" },
              "fundShortName": { "type": "string" },
              "investmentTarget": { "type": "string" },
              "investmentArea": { "type": "string" },
              "riskLevel": { "type": "integer" },
              "fundNameCategory": { "type": "string" },
              "url": { "type": "string" }
            }
          },
          "suggestions": {
            "type": "array",
            "description": "搭配建議清單",
            "items": {
              "type": "object",
              "properties": {
                "reason": { "type": "string", "description": "建議理由" },
                "recommendedFunds": {
                  "type": "array",
                  "description": "推薦的互補基金（最多 3 檔）",
                  "items": {
                    "type": "object",
                    "properties": {
                      "mfxId": { "type": "string" },
                      "fundShortName": { "type": "string" },
                      "investmentTarget": { "type": "string" },
                      "fundNameCategory": { "type": "string" },
                      "riskLevel": { "type": "integer" },
                      "investmentArea": { "type": "string" },
                      "dividendFrequency": { "type": "string" },
                      "rateOfReturn1Year": { "type": "number" },
                      "url": { "type": "string" }
                    }
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}
